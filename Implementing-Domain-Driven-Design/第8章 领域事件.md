第8章 领域事件
============

History is the version of past events that people have decided to agree upon. 
                                                                            —Napoleon Bonaparte

领域事件代表领域中已发生的一件事情。这是一种极强力的建模工具。一旦你掌握了运用领域事件的敲门，你会沉醉其中并且有一种相见恨晚的感觉。想叩开领域事件之门，你要做的仅仅是搞清楚你的领域中究竟会发生哪些事情。

***

**本章导读**  
• 探索什么是领域事件，何时以及为什么要运用领域事件。  
• 学习如果将事件设计成对象以及领域事件在什么时候是不能重复的。  
• 思考为什么轻量级的发布-订阅模式适合用来实现客户端通知。  
• 了解哪些组件会发布事件而那些组件会关注事件。  
• 考虑为什么以及如何开发事件仓库，以及事件仓库的使用方法。  
• 从SaaSOvation项目组身上学习事件是如何通过不同的方式发布到各自独立的系统中去的。  

***

**何时以及为什么要运用领域事件**   
在 [Evans] 一书中并没有领域事件有正式的定义。在这本书出版之后，该模式才被详细地提出来。在讨论如何实现领域事件之前，先来看看它的定义：
领域专家关注的已发生的事情。一系列不连贯的用来描述领域中各类活动的事件。每个事件代表一个领域对象…… 领域事件是领域模型中当仁不让的一部分，用以表示领域中已发生的事情。[Evans, Ref, p. 20]


到底哪些事情是领域专家关心的呢？当与领域专家的交换意见时，我们必须仔细倾听，寻找线索，请注意如下关键字：
• "当 . . ."  
• "如果遇到了 . . ."  
• "如果 . . .时，请告诉我” 或者 “如果 . . .请通知我"  
• "发生 . . .时"

诚然，"如果 . . .时，请告诉我”和“如果...请通知我"这样的措辞并不足以捕获领域事件。它们至多只是表达了该领域中有人希望知晓某个重要事件的结果，而这很有可能意味着需要在模型中加入一个明确的事件。此外，领域专家还可能会提到"哦，那种情况并不重要，但如果这样的话就很重要"(请按你的领域上下文呢替换"那种情况"和"这样的话")。在你所在的组织中，可能还有其他的关键字。


There will probably be times when the spoken language of the experts doesn’t lead to a clear
reason to model an Event, yet the business situation may still call for it. Domain experts may or may
not be aware of these kinds of requirements, and they could become known only as a result of crossteam
discussions. This tends to happen when Events must be broadcast to external services, where the
systems in your enterprise have been decoupled and occurrences throughout the domain must be
communicated across Bounded Contexts (2). Events like this get published, and subscribers are
notified. As such Events are handled by subscribers, they may have far-reaching impact on local and
remote Bounded Contexts.

虽然业务场景往往需要领域事件，但有时我们难以从和领域专家的谈话中捕捉到它们。领域专家并不一定能够意识到这也是一种需求，他们可能会认为领域事件只是一种跨界讨论的结果。这种情况比较容易出现在领域事件需要被传播到外部服务时，比如你所在企业的系统已经相互解耦而贯穿领域的事件需要跨限界上下文(2)传播。这时订阅者则收到领域事件被发布的通知并且对它们进行处理，这可能对本地或是远程上下文产生深远影响。
